
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>è®¾ç½®ç»‘å®šåœ°å€</title>
  <link rel="stylesheet" href="style_password.css" />
  <script>
    const userId = Telegram.WebApp.initDataUnsafe.user?.id || "unknown";
    let errorKey = `bindError_${userId}`;
    let passKey = `userPassword_${userId}`;

    function validateTRC20(address) {
      return /^T[a-zA-Z0-9]{33}$/.test(address);
    }

    function handleSubmit() {
      const address = document.getElementById("address").value.trim();
      const password = document.getElementById("password").value.trim();
      if (!validateTRC20(address)) {
        alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ TRC20 åœ°å€");
        return;
      }
      const stored = localStorage.getItem(passKey);
      if (!stored) {
        alert("âš ï¸ å½“å‰å°šæœªè®¾ç½®å®‰å…¨å¯†ç ï¼Œè¯·å…ˆå®Œæˆé¦–æ¬¡è®¾ç½®ã€‚");
        return;
      }
      if (password !== stored) {
        let err = parseInt(localStorage.getItem(errorKey) || "0") + 1;
        localStorage.setItem(errorKey, err);
        if (err >= 5) {
          alert("ğŸš« æ‚¨çš„è´¦æˆ·å·²ç»è¢«ç³»ç»Ÿé”å®šï¼Œè¯·è”ç³»å®¢æœäººå·¥å¤„ç†ã€‚");
        } else {
          alert(`ğŸš« æ‚¨çš„å®‰å…¨å¯†ç è¾“å…¥é”™è¯¯${err}æ¬¡ï¼Œé”™5æ¬¡å°†é”å®šã€‚`);
        }
        return;
      }
      localStorage.setItem(`withdrawAddress_${userId}`, address);
      window.location.href = "bind_address_success.html";
    }

    function focusShift(input) {
      input.value = input.value.replace(/[^0-9]/g, "").slice(0, 4);
    }
  </script>
</head>
<body>
  <div class="container">
    <div class="back-btn" onclick="history.back()">è¿”å›</div>
    <div class="title">è®¾ç½®ç»‘å®šåœ°å€</div>
    <div class="white-box">
      <label class="label">ğŸ”¸ç»‘å®šåœ°å€:</label>
      <input id="address" type="text" placeholder="è¯·è¾“å…¥USDT-TRC20åœ°å€" class="input" />
      <label class="label">ğŸ”¸æç°å¯†ç :</label>
      <input id="password" type="password" maxlength="4" oninput="focusShift(this)" placeholder="è¯·è¾“å…¥4ä½å®‰å…¨å¯†ç " class="input" />
    </div>
    <button class="button" onclick="handleSubmit()">ä¸‹ä¸€æ­¥</button>
  </div>
</body>
</html>
